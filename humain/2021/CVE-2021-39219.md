# CVE-2021-39219

- Published: 2021-09-17T20:15:00

- Modified: 2021-12-21T14:09:00

Wasmtime is an open source runtime for WebAssembly & WASI. Wasmtime before version 0.30.0 is affected by a type confusion vulnerability. As a Rust library the `wasmtime` crate clearly marks which functions are safe and which are `unsafe`, guaranteeing that if consumers never use `unsafe` then it should not be possible to have memory unsafety issues in their embeddings of Wasmtime. An issue was discovered in the safe API of `Linker::func_*` APIs. These APIs were previously not sound when one `Engine` was used to create the `Linker` and then a different `Engine` was used to create a `Store` and then the `Linker` was used to instantiate a module into that `Store`. Cross-`Engine` usage of functions is not supported in Wasmtime and this can result in type confusion of function pointers, resulting in being able to safely call a function with the wrong type. Triggering this bug requires using at least two `Engine` values in an embedding and then additionally using two different values with a `Linker` (one at the creation time of the `Linker` and another when instantiating a module with the `Linker`). It's expected that usage of more-than-one `Engine` in an embedding is relatively rare since an `Engine` is intended to be a globally shared resource, so the expectation is that the impact of this issue is relatively small. The fix implemented is to change this behavior to `panic!()` in Rust instead of silently allowing it. Using different `Engine` instances with a `Linker` is a programmer bug that `wasmtime` catches at runtime. This bug has been patched and users should upgrade to Wasmtime version 0.30.0. If you cannot upgrade Wasmtime and are using more than one `Engine` in your embedding it's recommended to instead use only one `Engine` for the entire program if possible. An `Engine` is designed to be a globally shared resource that is suitable to have only one for the lifetime of an entire process. If using multiple `Engine`s is required then code should be audited to ensure that `Linker` is only used with one `Engine`.

### CVSS Score: **3.3**

| authentication | complexity | vector |
| --- | --- | --- |
| NONE | MEDIUM | LOCAL |

| confidentiality | integrity | availability |
| --- | --- | --- |
| NONE | PARTIAL | PARTIAL |

## References

* https://crates.io/crates/wasmtime

* https://github.com/bytecodealliance/wasmtime/commit/b39f087414f27ae40c44449ed5d1154e03449bff

* https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-q879-9g95-56mx

* https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/Z2Z33FTXFQ6EOINVEQIP4DFBG53G5XIY/

* https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/WAVBRYDDUIY2ZR3K3FO4BVYJKIMJ5TP7/

<details>
<summary>About this repository</summary> 

  This repository is part of the project [Live Hack CVE](https://github.com/Live-Hack-CVE). Main website can be found [www.live-hack.org](https://www.live-hack.org) 
  
  Made by [Sn0wAlice](https://github.com/Sn0wAlice) for the people that care about security and need to have a feed of the latest CVEs. Hope you enjoy it, don't forget to star the repo and follow me on [Twitter](https://twitter.com/Sn0wAlice) and [Github](https://github.com/Sn0wAlice). And that is my [personnal website](https://www.alice-snow.me/)

  - [Home Page](https://github.com/Live-Hack-CVE)
  - [Framework](https://github.com/Live-Hack-CVE/cve-framework)
  - [CVE database](https://github.com/Live-Hack-CVE/full_database)
  - [Changelog](https://github.com/Live-Hack-CVE/Changelog)
</details>

## Brut File

* [CVE-2021-39219.json](https://raw.githubusercontent.com/Live-Hack-CVE/full_database/main/cves/2021/CVE-2021-39219.json)

